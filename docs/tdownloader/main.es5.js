"use strict";function _array_like_to_array(arr,len){if(len==null||len>arr.length)len=arr.length;for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _array_without_holes(arr){if(Array.isArray(arr))return _array_like_to_array(arr)}function _class_call_check(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}function _create_class(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _iterable_to_array(iter){if(typeof Symbol!=="undefined"&&iter[Symbol.iterator]!=null||iter["@@iterator"]!=null)return Array.from(iter)}function _non_iterable_spread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _to_consumable_array(arr){return _array_without_holes(arr)||_iterable_to_array(arr)||_unsupported_iterable_to_array(arr)||_non_iterable_spread()}function _unsupported_iterable_to_array(o,minLen){if(!o)return;if(typeof o==="string")return _array_like_to_array(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);if(n==="Object"&&o.constructor)n=o.constructor.name;if(n==="Map"||n==="Set")return Array.from(n);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _array_like_to_array(o,minLen)}function _ts_generator(thisArg,body){var f,y,t,_={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},g=Object.create((typeof Iterator==="function"?Iterator:Object).prototype),d=Object.defineProperty;return d(g,"next",{value:verb(0)}),d(g,"throw",{value:verb(1)}),d(g,"return",{value:verb(2)}),typeof Symbol==="function"&&d(g,Symbol.iterator,{value:function(){return this}}),g;function verb(n){return function(v){return step([n,v])}}function step(op){if(f)throw new TypeError("Generator is already executing.");while(g&&(g=0,op[0]&&(_=0)),_)try{if(f=1,y&&(t=op[0]&2?y["return"]:op[0]?y["throw"]||((t=y["return"])&&t.call(y),0):y.next)&&!(t=t.call(y,op[1])).done)return t;if(y=0,t)op=[op[0]&2,t.value];switch(op[0]){case 0:case 1:t=op;break;case 4:_.label++;return{value:op[1],done:false};case 5:_.label++;y=op[1];op=[0];continue;case 7:op=_.ops.pop();_.trys.pop();continue;default:if(!(t=_.trys,t=t.length>0&&t[t.length-1])&&(op[0]===6||op[0]===2)){_=0;continue}if(op[0]===3&&(!t||op[1]>t[0]&&op[1]<t[3])){_.label=op[1];break}if(op[0]===6&&_.label<t[1]){_.label=t[1];t=op;break}if(t&&_.label<t[2]){_.label=t[2];_.ops.push(op);break}if(t[2])_.ops.pop();_.trys.pop();continue}op=body.call(thisArg,_)}catch(e){op=[6,e];y=0}finally{f=t=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:true}}}(function(){var h=function h(){for(var _len=arguments.length,t=new Array(_len),_key=0;_key<_len;_key++){t[_key]=arguments[_key]}var _console;(_console=console).log.apply(_console,[i.name].concat(_to_consumable_array(t)))};var re=function re(){for(var _len=arguments.length,t=new Array(_len),_key=0;_key<_len;_key++){t[_key]=arguments[_key]}var _console;(_console=console).warn.apply(_console,[i.name].concat(_to_consumable_array(t)))};var ie=function ie(t){switch(t){case 0:return c.STOPPED;case 1:return c.CHECK_PENDING;case 2:return c.CHECKING;case 3:return c.DOWNLOAD_PENDING;case 4:return c.DOWNLOADING;case 5:return c.SEED_PENDING;case 6:return c.SEEDING;default:return c.UNKNOWN}};var de=function de(t){switch(t){case"allocating":return c.ALLOCATING;case"checkingDL":case"checkingUP":case"checkingResumeData":return c.CHECKING;case"queuedDL":return c.DOWNLOAD_PENDING;case"queuedUP":return c.SEED_PENDING;case"downloading":case"forcedMetaDL":return c.DOWNLOADING;case"uploading":case"forcedUP":return c.SEEDING;case"pausedDL":case"pausedUP":case"stoppedDL":case"stoppedUP":return c.STOPPED;case"stalledDL":case"stalledUP":return c.STALLED;case"missingFiles":return c.ISOLATED;case"moving":return c.MOVING;case"error":return c.ERROR;case"metaDL":case"forcedDL":return c.INITIALIZATION;default:return c.UNKNOWN}};var L=function L(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;if(t===0)return"0";var a=1024,o=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(a));return parseFloat((t/Math.pow(a,n)).toFixed(o))+" "+Lampa.Lang.translate("download-card.size.".concat(n))};var Ke=function Ke(t){var e=Lampa.Lang.translate("download-card.time.3");return"".concat(L(t),"/").concat(e)};var qe=function qe(t){var e=Math.floor(t/86400),a=Math.floor(t%86400/3600),o=Math.floor(t%3600/60),n=Math.floor(t%60);return[e,a,o,n].map(function(r,l){return r?r+Lampa.Lang.translate("download-card.time.".concat(l)):null}).filter(Boolean).slice(0,2).join(" ")};var Ge=function Ge(t){var e=new Date(t||"");return isNaN(e.getTime())?"":e.getFullYear()};var y=function y(t){var e=b.getMovieInfo(t),a=Y[Lampa.Storage.get(K)]||Y[1];return{id:t.id+"_"+t.externalId,title:(e==null?void 0:e.title)||(e==null?void 0:e.name)||(t.status===c.INITIALIZATION?"Initialization":t.name),poster:e!=null&&e.poster_path?Lampa.TMDB.image("t/p/".concat(a).concat(e.poster_path)):"",year:Ge((e==null?void 0:e.release_date)||(e==null?void 0:e.first_air_date)),fileName:e!=null&&e.title||e!=null&&e.name?t.name:"",percent:(100*t.percentDone).toFixed(2)+"%",speed:t.speed>0?Ke(t.speed):"",downloadedSize:L(t.percentDone*t.totalSize),totalSize:L(t.totalSize),eta:t.status===c.DOWNLOADING?qe(t.eta):t.status===c.STALLED&&t.percentDone===1?Lampa.Lang.translate("download-card.status.14"):Lampa.Lang.translate("download-card.status.".concat(t.status)),status:t.status===c.DOWNLOADING?"downloading":t.percentDone===1?"completed":"paused",seeders:"".concat(t.seeders||0," (").concat(t.activeSeeders||0,")")}};var pe=function pe(t,e,a){return d(this,null,function(){var o,n,s,w,r,m;return _ts_generator(this,function(_state){switch(_state.label){case 0:o=p.getClient();return[4,o.getFiles(e)];case 1:n=_state.sent(),s="".concat(o.url,"/downloads/").concat(e.path,"/");if(n.length<1)throw new Error("No files found in torrent");if(n.length===1&&ce({title:a||e.name,url:s+n[0].name,torrent_hash:e.hash}),n.length>1){r=T.getViews(e),m=n.sort(function(f,Z){return f.name.localeCompare(Z.name,void 0,{numeric:!0,sensitivity:"base"})}).map(function(f,Z){return{title:f.name.split(/[\\/]/).pop()||f.name,name:f.name,url:s+f.name,picked:r[f.name],selected:r.last===f.name,torrent_hash:e.hash}});Lampa.Select.show({title:Lampa.Lang.translate("actions.select-file"),items:m,onSelect:function onSelect(f){return d(this,null,function(){return _ts_generator(this,function(_state){T.rememberView(e,f.name),ce({playlist:m,title:a||e.name,url:f.url,torrent_hash:e.hash});return[2]})})},onBack:function onBack(){Lampa.Controller.toggle(t)}})}return[2]}})})};var ce=function ce(t){var e;h("Player request ".concat(t.url),t),Lampa.Player.play(t),Lampa.Player.playlist((e=t.playlist)!=null?e:[])};var me=function me(t){t.status===c.STOPPED?p.getClient().startTorrent(t):p.getClient().stopTorrent(t)};var S=function S(t,e,a){e=g.ensureMovie(e),Lampa.Select.show({title:Lampa.Lang.translate("actions.title"),items:[{title:Lampa.Lang.translate("actions.open"),onSelect:function onSelect(){return d(this,null,function(){return _ts_generator(this,function(_state){pe(t,e,a);return[2]})})}}].concat(_to_consumable_array(t==="downloads-tab"&&e.id?[{title:Lampa.Lang.translate("actions.open-card"),onSelect:function onSelect(){return d(this,null,function(){return _ts_generator(this,function(_state){Lampa.Activity.push({component:"full",id:e.id,method:e.type,card:e});return[2]})})}}]:[]),[{title:e.status===c.STOPPED?Lampa.Lang.translate("actions.resume"):Lampa.Lang.translate("actions.pause"),onSelect:function onSelect(){me(e),Lampa.Controller.toggle(t)}},{title:Lampa.Lang.translate("actions.hide"),onSelect:function onSelect(){p.getClient().hideTorrent(e),$('.downloads-tab__item[data-id="'.concat(e.id,"_").concat(e.externalId,'"]')).remove(),Lampa.Controller.toggle(t)}},{title:Lampa.Lang.translate("actions.delete"),subtitle:Lampa.Lang.translate("actions.delete-with-file"),onSelect:function onSelect(){p.getClient().removeTorrent(e,!0),$('.downloads-tab__item[data-id="'.concat(e.id,"_").concat(e.externalId,'"]')).remove(),Lampa.Controller.toggle(t)}},{title:Lampa.Lang.translate("actions.delete-torrent"),subtitle:Lampa.Lang.translate("actions.delete-torrent-keep-file"),onSelect:function onSelect(){p.getClient().removeTorrent(e,!1),$('.downloads-tab__item[data-id="'.concat(e.id,"_").concat(e.externalId,'"]')).remove(),Lampa.Controller.toggle(t)}}]),onBack:function onBack(){Lampa.Controller.toggle(t)}})};var C=function C(t,e,a){var o=Lampa.Storage.field(q);o==1?pe(t,e,a):o==2?me(e):S(t,e,a)};var G=function G(t,e){var a=$(Lampa.Template.get("download-card",y(t)));$(".full-start-new__right").append(a),a.on("hover:enter",function(){C("full_start",t,(e==null?void 0:e.title)||(e==null?void 0:e.original_title))}),a.on("hover:long",function(){S("full_start",t,(e==null?void 0:e.title)||(e==null?void 0:e.original_title))})};var ue=function ue(t){var e=y(t),a=document.getElementById("download-card-".concat(e.id));if(a){for(var o in e){var n=a.querySelector('[data-key="'.concat(o,'"]'));n&&(n.textContent=e[o])}a.querySelector(".download-card__progress-bar-progress").setAttribute("style","width: ".concat(e.percent,";"))}};var fe=function fe(){Lampa.Template.add("download-card",oe),$("body").append("<style>".concat(ne,"</style>")),Lampa.Listener.follow("full",function(t){if(t.type==="complite"){var e=g.getMovie(t.data.movie.id);e&&G(e,t.data.movie)}})};var he=function he(t,e){var a=$(e);if(!a.find(".download-circle").length){var o=Lampa.Template.get("download-circle",{id:t.id,status:t.percentDone===1?"complete":"in-progress",progress:100*(1-t.percentDone)});a.find(".card__vote").after(o)}};var Be=function Be(t,e){var a=g.getMovie(t);a&&he(a,e)};var _e=function _e(t){var e=document.querySelectorAll(".download-circle-in-progress-".concat(t.id));e.length&&e.forEach(function(a){if(t.percentDone===1){var o=a.parentElement;a.remove(),he(t,o)}else{var o1=a.querySelector(".download-circle__partial_in-progress");o1==null||o1.setAttribute("stroke-dashoffset","".concat(100*(1-t.percentDone)))}})};var be=function be(){Lampa.Template.add("download-circle",ge),$("body").append("<style>".concat(we,"</style>")),Lampa.Listener.follow("line",function(t){var e,a;var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(t.type==="append")try{for(var _iterator=t.items[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var o=_step.value;(e=o==null?void 0:o.data)!=null&&e.id&&Be((a=o==null?void 0:o.data)==null?void 0:a.id,o.card)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}})};var Se=function Se(t){var e=y(t),a=$(document).find('.downloads-tab__item[data-id="'.concat(e.id,'"]'));a.length&&(a.removeClass("downloading completed paused").addClass(e.status),a.find(".downloads-tab__progress-fill").css("width",e.percent),a.find(".downloads-tab__poster").css("background-image","url(".concat(e.poster,")")),Object.keys(e).forEach(function(o){a.find('[data-field="'.concat(o,'"]')).each(function(){$(this).text(e[o])})}))};var Ie=function Ie(){Lampa.Template.add("menu-button",Te),Lampa.Template.add("downloads-row",ve),Lampa.Template.add("downloads-tab",ye),$("body").append("<style>".concat(Le,"</style>")),Lampa.Component.add("downloads-tab",W);var t=Lampa.Lang.translate("downloads"),e=$(Lampa.Template.get("menu-button",{icon:v,text:t}));e.on("hover:enter",function(){Lampa.Activity.push({url:"",title:t,component:"downloads-tab",page:1})}),$(".menu .menu__list").eq(0).append(e)};var De=function De(){Lampa.SettingsApi.addComponent({component:i.component,name:i.name,icon:v}),Lampa.SettingsApi.addParam({component:i.component,param:{name:B,type:"select",placeholder:"2s",values:["2s","5s","10s","30s","1m","5m","15m"],default:0},field:{name:"Update interval"},onChange:function onChange(t){Lampa.Settings.update(),_.start()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:q,type:"select",placeholder:"",values:["Open actions menu","Play","Resume / Pause download"],default:0},field:{name:"Default press action",description:"Long press always opens the actions menu."},onChange:function onChange(t){Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:V,type:"trigger",default:!1},field:{name:"Keep torrents screen open after download",description:"After selecting a torrent, the app does not return back and keeps the add screen open, allowing you to add multiple torrents in a row."},onChange:function onChange(t){Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:K,type:"select",placeholder:"",values:["Low","Medium","High","Very High","Ultra"],default:1},field:{name:"Poster quality"},onChange:function onChange(t){Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:"transmission-title",type:"title",default:""},field:{name:"Server settings:"}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:J,type:"select",placeholder:"",values:["Transmission","qBitTorrent"],default:"0"},field:{name:"Torrent Client"},onChange:function onChange(t){Lampa.Settings.update(),p.reset()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:I,type:"input",placeholder:"",values:"",default:""},field:{name:"Url"},onChange:function onChange(t){Lampa.Settings.update(),p.reset()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:j,type:"input",placeholder:"",values:"",default:""},field:{name:"Login"},onChange:function onChange(t){Lampa.Settings.update(),p.reset()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:H,type:"input",placeholder:"",values:"",default:""},field:{name:"Password"},onChange:function onChange(t){Lampa.Settings.update(),p.reset()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:"jellyfin-title",type:"title",default:""},field:{name:"Jellyfin / Plex integration:"}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:Q,type:"trigger",default:!1},field:{name:"Download movies and TV shows into separate directories"},onChange:function onChange(){Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:P,type:"trigger",default:!1},field:{name:"Download into a subfolder with title"},onChange:function onChange(){Lampa.Storage.field(P)!==!0&&(Lampa.Storage.set(k,!1),Lampa.Storage.set(N,!1)),Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:k,type:"trigger",default:!1},field:{name:"Add (year) to folder name"},onRender:function onRender(t){Lampa.Storage.field(P)===!0?t.show():t.hide()},onChange:function onChange(){Lampa.Settings.update()}}),Lampa.SettingsApi.addParam({component:i.component,param:{name:N,type:"trigger",default:!1},field:{name:"Add [tmdbid-***] to folder name"},onRender:function onRender(t){Lampa.Storage.field(P)===!0?t.show():t.hide()},onChange:function onChange(){Lampa.Settings.update()}})};var O=function O(t){var o;var a=((o=(typeof t=="string"?t.split(",").map(function(n){return n.trim()}):t).find(function(n){return n.startsWith(Ae)}))==null?void 0:o.split(":")[1])||"";return parseInt(a)};var R=function R(t){return(typeof t=="string"?t.split(",").map(function(a){return a.trim()}):t).indexOf("tv")!==-1?"tv":"movie"};var x=function x(t){var e=[Ae+t.id];return Ee(t)&&e.push("tv"),e};var M=function M(t){var e=(t.title||t.name).trim(),a=t.release_year||(t.release_date?t.release_date.slice(0,4):"")||(t.first_air_date?t.first_air_date.slice(0,4):""),o="";return Lampa.Storage.field(Q)&&(o+="/".concat(Ee(t)?"tv":"movie")),o+="/".concat(e),Lampa.Storage.field(k)&&a&&(o+=" (".concat(a,")")),Lampa.Storage.field(N)&&(o+=" [tmdbid-".concat(t.id,"]")),o};var Ee=function Ee(t){return Array.isArray(t.seasons)||t.season!==void 0||t.episode_number!==void 0};var Qe=function Qe(t){var e=$(Lampa.Template.get("download-button",{icon:v,text:Lampa.Lang.translate("download")}));e.on("hover:enter",function(a){Lampa.Activity.push({url:"",title:Lampa.Lang.translate("download"),component:"torrents-download",search_one:t.movie.title,search_two:t.movie.original_title,movie:t.movie,page:1})}),$(".full-start-new__buttons").children().first().after(e)};var Pe=function Pe(){var _this=this;Lampa.Template.add("download-button",Ce),Lampa.Component.add("torrents-download",Lampa.Component.get("torrents")),Lampa.Listener.follow("full",function(t){if(t.type==="complite"){var e=t.data;Qe(e)}}),Lampa.Listener.follow("torrent",function(t){var e=Lampa.Activity.active();t.type==="render"&&e.component==="torrents-download"&&($(t.item).off("hover:enter"),$(t.item).on("hover:enter",function(a){return d(_this,null,function(){var s;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,p.getClient().addTorrent(e.movie,t.element)];case 1:if(!(_state.sent(),Lampa.Noty.show(Lampa.Lang.translate("download-button.added")),e.activity.component.mark(t.element,t.item,!0),!Lampa.Storage.get(V,!1)))return[3,3];Lampa.Activity.back();return[4,p.getClient().getTorrents()];case 2:s=_state.sent().find(function(r){return r.id===e.movie.id});G(s,e.movie);_state.label=3;case 3:return[2]}})})}))})};var ke=function ke(){window.plugin_transmission_ready=!0,Lampa.Manifest.plugins=i,Lampa.Lang.add(te),De(),Pe(),fe(),Ie(),be(),Lampa.Storage.field(I)&&_.start()};var Ne=Object.defineProperty,Oe=Object.defineProperties;var Re=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var $e=Object.prototype.hasOwnProperty,Me=Object.prototype.propertyIsEnumerable;var ee=function(t,e,a){return e in t?Ne(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a},A=function(t,e){for(var a in e||(e={}))$e.call(e,a)&&ee(t,a,e[a]);var _iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(X)try{for(var _iterator=X(e)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var a=_step.value;Me.call(e,a)&&ee(t,a,e[a])}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}return t},E=function(t,e){return Oe(t,Re(e))};var d=function(t,e,a){return new Promise(function(o,n){var s=function(m){try{l(a.next(m))}catch(w){n(w)}},r=function(m){try{l(a.throw(m))}catch(w){n(w)}},l=function(m){return m.done?o(m.value):Promise.resolve(m.value).then(s,r)};l((a=a.apply(t,e)).next())})};var te={downloads:{ru:"Загрузки",en:"Downloads"},download:{ru:"Скачать",en:"Download"},"download-button.added":{ru:"Торрент добавлен",en:"Torrent added"},"downloads-tab.connected":{ru:"Подключено",en:"Connected"},"downloads-tab.disconnected":{ru:"Нет подключения",en:"Disconnected"},"downloads-tab.freespace":{ru:"Свободное место: ",en:"Free space: "},"download-card.time.0":{en:"d",ru:"д"},"download-card.time.1":{en:"h",ru:"ч"},"download-card.time.2":{en:"min",ru:"мин"},"download-card.time.3":{en:"s",ru:"сек"},"download-card.status.0":{en:"stopped",ru:"пауза"},"download-card.status.1":{en:"queued to verify local data",ru:"ждёт проверки"},"download-card.status.2":{en:"verifying local data",ru:"проверка данных"},"download-card.status.3":{en:"queued to download",ru:"ждёт загрузки"},"download-card.status.4":{en:"downloading",ru:"загрузка"},"download-card.status.5":{en:"queued to seed",ru:"ждёт раздачи"},"download-card.status.6":{en:"seeding",ru:"раздаётся"},"download-card.status.7":{en:"isolated",ru:"нет пиров"},"download-card.status.8":{en:"stalled",ru:"простаивает"},"download-card.status.9":{en:"error",ru:"ошибка"},"download-card.status.10":{en:"allocating",ru:"выделение места"},"download-card.status.11":{en:"moving",ru:"перемещение"},"download-card.status.12":{en:"unknown",ru:"неизвестно"},"download-card.status.13":{en:"initializing",ru:"инициализация"},"download-card.status.14":{en:"completed",ru:"завершено"},"download-card.size.0":{en:"B",ru:"Б"},"download-card.size.1":{en:"KB",ru:"КБ"},"download-card.size.2":{en:"MB",ru:"МБ"},"download-card.size.3":{en:"GB",ru:"ГБ"},"download-card.size.4":{en:"TB",ru:"ТБ"},"actions.title":{ru:"Действия",en:"Actions"},"actions.open":{ru:"Воспроизвести",en:"Play"},"actions.open-card":{ru:"Открыть карточку фильма",en:"Open movie card"},"actions.select-file":{ru:"Файлы:",en:"Files:"},"actions.pause":{ru:"Пауза",en:"Pause"},"actions.resume":{ru:"Продолжить",en:"Resume"},"actions.hide":{ru:"Скрыть",en:"Hide"},"actions.delete":{ru:"Удалить",en:"Delete"},"actions.delete-with-file":{ru:"Удалить торрент и файл",en:"Delete torrent and file"},"actions.delete-torrent":{ru:"Удалить торрент",en:"Delete torrent"},"actions.delete-torrent-keep-file":{ru:"Удалить торрент, но оставить файл",en:"Delete torrent but keep file"},"background-worker.connection-success":{ru:"Подключение к серверу успешно установлено",en:"Connection to server successfully established"},"background-worker.error-detected":{ru:"Обнаружена ошибка. Подробнее в консоли",en:"An error has been detected. See console for details"}};var v='<svg xmlns="http://www.w3.org/2000/svg" width="34" height="34" viewBox="4 4 16 16">\r\n    <path fill="currentcolor" d="M17.71,12.71a1,1,0,0,0-1.42,0L13,16V6a1,1,0,0,0-2,0V16L7.71,12.71a1,1,0,0,0-1.42,0,1,1,0,0,0,0,1.41l4.3,4.29A2,2,0,0,0,12,19h0a2,2,0,0,0,1.4-.59l4.3-4.29A1,1,0,0,0,17.71,12.71Z" />\r\n</svg>';var i={type:"other",version:"2.4.3",author:"https://github.com/kvart714",name:"Torrent Downloader",description:"Transmission RPC client",component:"t-downloader"};var ae=i.component+".torrents.data.v2",g=/*#__PURE__*/function(){function g(){_class_call_check(this,g)}_create_class(g,null,[{key:"getData",value:function getData(){return this.data}},{key:"getMovie",value:function getMovie(e){var a=this.data.torrents.filter(function(o){return o.id===e});return a.length>0?a.reduce(function(o,n){return o.percentDone<n.percentDone?o:n}):null}},{key:"ensureMovie",value:function ensureMovie(e){var a=this.data.torrents.filter(function(o){return o.externalId===e.externalId});return a.length>0?a.reduce(function(o,n){return o.percentDone<n.percentDone?o:n}):e}},{key:"setData",value:function setData(e){return d(this,null,function(){return _ts_generator(this,function(_state){this.data=e,Lampa.Storage.set(ae,this.data);return[2]})})}}]);return g}();g.data=Lampa.Storage.get(ae,{torrents:[],info:{freeSpace:0}});var oe='<div class="selector download-card full-start__button d-updatable" id="download-card-{id}">\r\n  <div class="download-card__file-info">\r\n    <span class="file-name">\r\n      <span data-key="fileName">{fileName}</span>\r\n    </span>\r\n    <span class="speed">\r\n      <span data-key="speed">{speed}</span>\r\n    </span>\r\n  </div>\r\n  <div class="download-card__progress-bar">\r\n    <div class="download-card__progress-bar-progress" style="width: {percent}"></div>\r\n  </div>\r\n  <div class="download-card__stats">\r\n    <span class="downloaded">\r\n      <span data-key="downloadedSize">{downloadedSize}</span> / \r\n      <span data-key="totalSize">{totalSize}</span>\r\n    </span>\r\n    <span class="percent">\r\n      <span data-key="percent">{percent}</span>\r\n    </span>\r\n    <span class="eta">\r\n      <span data-key="eta">{eta}</span>\r\n    </span>\r\n  </div>\r\n</div>\r\n';var ne=".download-card {\n  all: unset;\n  display: block;\n  width: 80%;\n  height: auto;\n  margin: 0;\n  margin-top: 0.75em;\n  padding: 0.75em;\n  background-color: rgba(0, 0, 0, 0.3);\n  color: white;\n  transition: background-color 0.3s;\n  border-radius: 1em;\n}\n.download-card__file-info {\n  display: flex;\n  justify-content: space-between;\n  margin-bottom: 0.5em;\n}\n.download-card__file-info .file-name, .download-card__file-info .speed {\n  font-size: 1.5em;\n}\n.download-card__progress-bar {\n  height: 6px;\n  background: #ddd;\n  border-radius: 6px;\n  overflow: hidden;\n  margin-top: 0.7em;\n  margin-bottom: 0.5em;\n}\n.download-card__progress-bar-progress {\n  height: 100%;\n  background: linear-gradient(90deg, #4a90e2, #357ab8);\n  transition: width 0.5s ease;\n}\n.download-card__stats {\n  position: relative;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5em;\n  font-size: 1.1em;\n}\n.download-card__stats .speed {\n  position: absolute;\n  top: 0;\n  right: 0;\n  font-size: inherit;\n}\n.download-card__stats .percent {\n  position: absolute;\n  bottom: 0;\n  left: 50%;\n  transform: translateX(-50%);\n  font-size: inherit;\n}\n.download-card__stats .downloaded {\n  text-align: left;\n  font-size: inherit;\n}\n.download-card__stats .eta {\n  position: absolute;\n  bottom: 0;\n  right: 0;\n  font-size: inherit;\n}";var se=i.component+".movieinfo.data.v4",b=/*#__PURE__*/function(){function b(){_class_call_check(this,b)}_create_class(b,null,[{key:"getMovieInfo",value:function getMovieInfo(e){var _this=this;if(!e.id)return null;var a="".concat(e.type,"_").concat(e.id);return this.memoryCache[a]?this.memoryCache[a]:(this.requestedIds.has(a)||(this.requestedIds.add(a),this.loadContentInfo(e.id,e.type).then(function(o){if(o){_this.memoryCache[a]=o,_this.diskCache[a]=o,Lampa.Storage.set(se,_this.diskCache);return}})),this.diskCache[a]||null)}},{key:"loadContentInfo",value:function loadContentInfo(e,a){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;return d(this,null,function(){var n,s,_$r,l,l1,r;return _ts_generator(this,function(_state){switch(_state.label){case 0:n=Lampa.Storage.field("tmdb_lang")||Lampa.Storage.field("language")||"ru",s=Lampa.Utils.addUrlComponent(Lampa.TMDB.api("".concat(a,"/").concat(e,"?email=")),"api_key=".concat(Lampa.TMDB.key(),"&language=").concat(n,"&certification_country=ru&certification.lte=18"));_state.label=1;case 1:_state.trys.push([1,7,,8]);return[4,fetch(s)];case 2:_$r=_state.sent();if(!_$r.ok)return[3,4];return[4,_$r.json()];case 3:l=_state.sent();if(l!=null&&l.title||l!=null&&l.name)return[2,l];return[3,6];case 4:if(!o)return[3,6];h("Failed to load '".concat(a,"_").concat(e,"', status: ").concat(_$r.status,". Trying fallback type."));l1=a==="movie"?"tv":"movie";return[4,this.loadContentInfo(e,l1,!1)];case 5:return[2,_state.sent()];case 6:return[3,8];case 7:r=_state.sent();re("Failed to load ".concat(a," info for id ").concat(e,":"),r);return[3,8];case 8:return[2,null]}})})}}]);return b}();b.requestedIds=new Set,b.diskCache=Lampa.Storage.get(se,{}),b.memoryCache={};var c={STOPPED:0,CHECK_PENDING:1,CHECKING:2,DOWNLOAD_PENDING:3,DOWNLOADING:4,SEED_PENDING:5,SEEDING:6,ISOLATED:7,STALLED:8,ERROR:9,ALLOCATING:10,MOVING:11,UNKNOWN:12,INITIALIZATION:13};var le=i.component+".torrents.data.views.",T=/*#__PURE__*/function(){function t(){_class_call_check(this,t)}_create_class(t,null,[{key:"getViews",value:function getViews(e){return Lampa.Storage.get(le+e.externalId)}},{key:"rememberView",value:function rememberView(e,a){var o=t.getViews(e)||{};o.last=a,o[a]=!0,Lampa.Storage.set(le+e.externalId,o)}}]);return t}();var ge='<div class="download-circle d-updatable download-circle-{status}-{id}">\r\n    <div class="download-circle__circle">\r\n        <svg class="download-circle__circle-svg" xmlns="http://www.w3.org/2000/svg">\r\n            <circle\r\n                fill="rgba(0, 0, 0, 0.60)"\r\n                r="17px"\r\n                cx="20"\r\n                cy="20"\r\n            ></circle>\r\n            <circle\r\n                class="download-circle__full_{status}"\r\n                stroke-width="2px"\r\n                r="12px"\r\n                cx="20"\r\n                cy="20"\r\n            ></circle>\r\n            <circle\r\n                class="download-circle__partial_{status}"\r\n                fill="none"\r\n                stroke="#fff"\r\n                stroke-width="2px"\r\n                stroke-dasharray="100"\r\n                stroke-dashoffset="{progress}"\r\n                transition="stroke-dasharray 0.7s linear 0s"\r\n                r="12px"\r\n                cx="20"\r\n                cy="20"\r\n                pathlength="100"\r\n            ></circle>\r\n        </svg>\r\n    </div>\r\n    <div class="download-circle__down-arrow">\r\n        <svg\r\n            class="download-circle__down-arrow-svg_{status}"\r\n            xmlns="http://www.w3.org/2000/svg"\r\n        >\r\n            <path\r\n                d="M17.71,12.71a1,1,0,0,0-1.42,0L13,16V6a1,1,0,0,0-2,0V16L7.71,12.71a1,1,0,0,0-1.42,0,1,1,0,0,0,0,1.41l4.3,4.29A2,2,0,0,0,12,19h0a2,2,0,0,0,1.4-.59l4.3-4.29A1,1,0,0,0,17.71,12.71Z"\r\n            />\r\n        </svg>\r\n        <svg\r\n            class="download-circle__down-arrow-svg-animated_{status}"\r\n            fill="white"\r\n            xmlns="http://www.w3.org/2000/svg"\r\n        >\r\n            <path\r\n                d="M17.71,12.71a1,1,0,0,0-1.42,0L13,16V6a1,1,0,0,0-2,0V16L7.71,12.71a1,1,0,0,0-1.42,0,1,1,0,0,0,0,1.41l4.3,4.29A2,2,0,0,0,12,19h0a2,2,0,0,0,1.4-.59l4.3-4.29A1,1,0,0,0,17.71,12.71Z"\r\n            />\r\n        </svg>\r\n    </div>\r\n</div>\r\n';var we='.download-complete,\n.download-circle {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 40px;\n  height: 40px;\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%) scale(2);\n}\n.download-complete__circle,\n.download-circle__circle {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  width: 40px;\n  height: 40px;\n  cursor: pointer;\n  position: relative;\n}\n.download-complete__circle-svg,\n.download-circle__circle-svg {\n  transform: rotate(-90deg);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n.download-complete__full_in-progress,\n.download-circle__full_in-progress {\n  fill: none;\n  stroke: rgba(255, 255, 255, 0.5);\n}\n.download-complete__full_complete,\n.download-circle__full_complete {\n  fill: white;\n  stroke: none;\n}\n.download-complete__partial_complete,\n.download-circle__partial_complete {\n  display: none;\n}\n.download-complete__partial_in-progress,\n.download-circle__partial_in-progress {\n  transition: stroke-dashoffset 0.5s ease;\n}\n.download-complete__down-arrow,\n.download-circle__down-arrow {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  overflow: hidden;\n}\n.download-complete__down-arrow svg,\n.download-circle__down-arrow svg {\n  width: 24px;\n  height: 24px;\n}\n.download-complete__down-arrow-svg_in-progress,\n.download-circle__down-arrow-svg_in-progress {\n  fill: rgba(255, 255, 255, 0.5);\n}\n.download-complete__down-arrow-svg_complete,\n.download-circle__down-arrow-svg_complete {\n  fill: "white";\n}\n.download-complete__down-arrow-svg-animated_in-progress,\n.download-circle__down-arrow-svg-animated_in-progress {\n  position: absolute;\n  clip-path: inset(0 0 100% 0);\n  animation: pulseColor 2s ease-out infinite;\n}\n.download-complete__down-arrow-svg-animated_complete,\n.download-circle__down-arrow-svg-animated_complete {\n  display: none;\n}\n\n@keyframes pulseColor {\n  0% {\n    clip-path: inset(0 0 100% 0);\n  }\n  30% {\n    clip-path: inset(0 0 0 0);\n  }\n  70% {\n    clip-path: inset(0 0 0 0);\n  }\n  100% {\n    clip-path: inset(100% 0 0 0);\n  }\n}';var ve='<div class="downloads-tab__item selector {status}" data-id="{id}">\n  <div class="downloads-tab__poster" style="background-image: url(\'{poster}\')"></div>\n  <div class="downloads-tab__main">\n    <div class="downloads-tab__movie"><span data-field="movieTitle">{title}</span></div>\n    <div class="downloads-tab__year"><span data-field="year">{year}</span></div>\n    <div class="downloads-tab__file"><span data-field="fileName">{fileName}</span></div>\n\n    <div class="downloads-tab__footer">\n      <div class="downloads-tab__meta-top">\n        <div class="downloads-tab__meta-left">\n          <span class="downloads-tab__meta-text" data-field="percent">{percent}</span>\n          <span> • </span>\n          <span class="downloads-tab__meta-text" data-field="seeders">{seeders}</span>\n        </div>\n        <span class="downloads-tab__speed"><span data-field="speed">{speed}</span></span>\n      </div>\n\n      <div class="downloads-tab__progress-wrapper">\n        <div class="downloads-tab__progress-fill" style="width: {percent};"></div>\n      </div>\n\n      <div class="downloads-tab__meta-bottom">\n        <div class="downloads-tab__sizes">\n          <span class="downloads-tab__meta-downloaded" data-field="downloadedSize">{downloadedSize}</span>\n          <span class="downloads-tab__meta-slash"> / </span>\n          <span class="downloads-tab__meta-total" data-field="totalSize">{totalSize}</span>\n        </div>\n        <span class="downloads-tab__eta" data-field="eta">{eta}</span>\n      </div>\n    </div>\n  </div>\n</div>\n';var ye='<div class="downloads-tab__list d-updatable">\r\n  <div class="downloads-tab__header-title-wrapper">\r\n    <div class="downloads-tab__header-title">{server}</div>\r\n    <div class="downloads-tab__header-size">{freeSpace}</div>\r\n  </div>\r\n  <div class="downloads-tab__rows"></div>\r\n</div>\r\n';var Le='@charset "UTF-8";\n.downloads-tab__list {\n  --color-text-primary: #dbdbdb;\n  --color-text-muted: #b1b1b1;\n  --fs-header: 1.4em;\n  --fs-title: 1.6em;\n  --fs-file: 1em;\n  --fs-body: 1.2em;\n  --sp-after-title: 0.3em;\n  --sp-between-text-and-progress: 0.5em;\n  --accent-violet: #b67dff;\n  --accent-violet-light: #c698ff;\n  --card-bg-color: 24, 24, 24;\n  --card-bg-alpha: 0.8;\n  --card-bg-alpha-hover: 0.6;\n  --poster-scale-hover: 1.04;\n  color: var(--color-text-muted);\n  padding: 1em;\n}\n.downloads-tab__list .downloads-tab__header-title-wrapper {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 1em;\n  font-size: var(--fs-header);\n  font-weight: 700;\n  color: var(--color-text-primary);\n}\n.downloads-tab__list .downloads-tab__rows {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 1em;\n}\n.downloads-tab__item {\n  display: grid;\n  grid-template-columns: 9em 1fr;\n  gap: 1em;\n  padding: 0.8em;\n  border-radius: 0.6em;\n  background: rgba(var(--card-bg-color), var(--card-bg-alpha));\n  box-shadow: 0 0.5em 1.2em rgba(0, 0, 0, 0.5);\n  transition: background 0.15s ease, box-shadow 0.15s ease;\n  /* состояния */\n  /* масштаб постера при hover/focus на item */\n}\n.downloads-tab__item:hover, .downloads-tab__item.focus, .downloads-tab__item:focus-visible {\n  outline: 3px solid var(--accent-violet);\n  background: rgba(var(--card-bg-color), var(--card-bg-alpha-hover));\n}\n.downloads-tab__item.downloading .downloads-tab__meta-left {\n  display: inline;\n}\n.downloads-tab__item.completed .downloads-tab__meta-downloaded,\n.downloads-tab__item.completed .downloads-tab__meta-slash {\n  display: none;\n}\n.downloads-tab__item:hover .downloads-tab__poster, .downloads-tab__item.focus .downloads-tab__poster, .downloads-tab__item:focus-visible .downloads-tab__poster {\n  transform: scale(var(--poster-scale-hover));\n}\n.downloads-tab__poster {\n  position: relative;\n  width: 9em;\n  height: 13.5em;\n  border-radius: 0.6em;\n  overflow: hidden;\n  background-color: rgb(35, 35, 35);\n  background-position: center;\n  background-repeat: no-repeat;\n  background-size: cover;\n  transition: transform 0.2s ease;\n}\n.downloads-tab__poster::after {\n  content: "POSTER";\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  font-size: 1em;\n  font-weight: 600;\n  letter-spacing: 0.05em;\n  color: rgba(255, 255, 255, 0.08);\n  pointer-events: none;\n  user-select: none;\n}\n.downloads-tab__main {\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: auto auto 1fr auto;\n  min-height: 13.5em;\n}\n.downloads-tab__movie {\n  font-size: var(--fs-title);\n  font-weight: 700;\n  color: var(--color-text-primary);\n  line-height: 1.2;\n  margin-bottom: var(--sp-after-title);\n  word-break: break-word;\n  overflow-wrap: break-word;\n}\n.downloads-tab__year {\n  color: var(--color-text-muted);\n  margin-bottom: 0.8em;\n  font-weight: bold;\n}\n.downloads-tab__file {\n  font-size: var(--fs-file);\n  font-weight: 500;\n  color: #727272;\n  margin-bottom: var(--sp-between-text-and-progress);\n  overflow-wrap: anywhere;\n}\n.downloads-tab__footer {\n  align-self: end;\n  display: grid;\n  row-gap: var(--sp-between-text-and-progress);\n  font-size: var(--fs-body);\n  font-weight: 500;\n  color: var(--color-text-muted);\n}\n.downloads-tab__meta-top {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 0.8em;\n}\n.downloads-tab__meta-left {\n  display: none;\n  white-space: nowrap;\n}\n.downloads-tab__speed {\n  font-weight: 600;\n  color: var(--color-text-primary);\n}\n.downloads-tab__progress-wrapper {\n  height: 0.5em;\n  border-radius: 4px;\n  overflow: hidden;\n  background: #2a2a2a;\n}\n.downloads-tab__progress-fill {\n  height: 100%;\n  background: linear-gradient(90deg, var(--accent-violet), var(--accent-violet-light));\n  will-change: width;\n  transition: width 0.25s ease;\n}\n.downloads-tab__meta-bottom {\n  display: grid;\n  grid-template-columns: 1fr auto;\n  align-items: center;\n  column-gap: 0.8em;\n}\n.downloads-tab__sizes {\n  white-space: nowrap;\n}\n.downloads-tab__eta {\n  font-weight: 600;\n  color: var(--color-text-primary);\n  white-space: nowrap;\n}\n@media (orientation: portrait) {\n  .downloads-tab__list .downloads-tab__rows {\n    grid-template-columns: 1fr;\n  }\n  .downloads-tab__list .downloads-tab__header-title-wrapper {\n    flex-direction: column;\n    align-items: flex-start;\n    gap: 0.3em;\n  }\n}\n@media (prefers-reduced-motion: reduce) {\n  .downloads-tab__item, .downloads-tab__poster, .downloads-tab__progress-fill {\n    transition: none;\n  }\n}';var Te='<li class="menu__item selector">\r\n    <div class="menu__ico">{icon}</div>\r\n    <div class="menu__text">{text}</div>\r\n</li>\r\n';var W=/*#__PURE__*/function(){function W(){_class_call_check(this,W);this.html=$("<div></div>");this.lastFocusedElement=null}_create_class(W,[{key:"create",value:function create(){var _this=this;p.isConnected||_.start(),this.scroll=new Lampa.Scroll({mask:!0,over:!0,step:200});var e=g.getData(),a=p.isConnected?Lampa.Lang.translate("downloads-tab.connected")+" ("+p.getClient().url+")":Lampa.Lang.translate("downloads-tab.disconnected"),o=$(Lampa.Template.get("downloads-tab",{server:a,freeSpace:Lampa.Lang.translate("downloads-tab.freespace")+L(e.info.freeSpace)})),n=o.find(".downloads-tab__rows");e.torrents.forEach(function(s){var r=y(s),l=$(Lampa.Template.get("downloads-row",r)).on("hover:focus",function(m){return _this.scroll.update(m.currentTarget,!0)}).on("hover:enter",function(){return C("downloads-tab",s)}).on("hover:long",function(){return S("downloads-tab",s)});n.append(l)}),this.scroll.minus(),this.scroll.append(o.get(0)),this.html.append(this.scroll.render())}},{key:"render",value:function render(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1;return this.html}},{key:"start",value:function start(){var _this=this;Lampa.Controller.add("downloads-tab",{toggle:function(){var e;Lampa.Controller.collectionSet(_this.scroll.render()),Lampa.Controller.collectionFocus((e=_this.lastFocusedElement)!=null?e:!1,_this.scroll.render())},left:function(){return Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){return Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head"),_this.lastFocusedElement=Navigator.getFocusedElement()},down:function(){Navigator.canmove("down")&&Navigator.move("down"),_this.lastFocusedElement=Navigator.getFocusedElement()},back:function(){return Lampa.Activity.backward()}}),Lampa.Controller.toggle("downloads-tab")}},{key:"build",value:function build(e){}},{key:"bind",value:function bind(e){}},{key:"empty",value:function empty(){}},{key:"next",value:function next(){}},{key:"append",value:function append(e,a){}},{key:"limit",value:function limit(){}},{key:"refresh",value:function refresh(){}},{key:"pause",value:function pause(){}},{key:"stop",value:function stop(){}},{key:"destroy",value:function destroy(){this.scroll.destroy(),this.html.remove()}}]);return W}();var u=/*#__PURE__*/function(){function u(){_class_call_check(this,u)}_create_class(u,null,[{key:"start",value:function start(){var e=xe[Lampa.Storage.field(B)];u.subscription&&clearInterval(u.subscription),u.errorCount=0,u.notified=!1,u.subscription=setInterval(u.tick,e*1e3)}},{key:"tick",value:function tick(){return d(this,null,function(){var _$e,_iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,o,a,e;return _ts_generator(this,function(_state){switch(_state.label){case 0:_state.trys.push([0,2,,3]);return[4,p.getClient().getData()];case 1:_$e=_state.sent();_iteratorNormalCompletion=true,_didIteratorError=false,_iteratorError=undefined;if(g.setData(_$e),$(".d-updatable").length)try{for(_iterator=_$e.torrents[Symbol.iterator]();!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){o=_step.value;ue(o),_e(o),Se(o)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator.return!=null){_iterator.return()}}finally{if(_didIteratorError){throw _iteratorError}}}a=p.getClient().url;p.isConnected||h("Connected to "+a),p.isConnected=!0,u.notifyFirstTime(Lampa.Lang.translate("background-worker.connection-success")+": "+a);return[3,3];case 2:e=_state.sent();h("Error:",e),p.isConnected=!1,u.errorCount++,u.errorCount>10&&(clearInterval(u.subscription),h("Stopping background worker due to too many errors"),u.notifyFirstTime(Lampa.Lang.translate("background-worker.error-detected")));return[3,3];case 3:return[2]}})})}},{key:"notifyFirstTime",value:function notifyFirstTime(e){u.notified||(Lampa.Noty.show(e),u.notified=!0)}}]);return u}();u.errorCount=0,u.notified=!1;var _=u;var B="".concat(i.component,".interval"),q="".concat(i.component,".default-action"),V="".concat(i.component,".allow-multiple-marks"),K="".concat(i.component,".poster-quality"),I="".concat(i.component,".server.url"),j="".concat(i.component,".server.login"),H="".concat(i.component,".server.password"),J="".concat(i.component,".server.type"),Q="".concat(i.component,".jellyfin.separate-movies-tv"),P="".concat(i.component,".jellyfin.subfolder"),k="".concat(i.component,".jellyfin.include-year"),N="".concat(i.component,".jellyfin.include-tmdbid"),xe=[2,5,10,30,60,5*60,15*60],Y=["w200","w342","w500","w780","w1280"];var Ae="lampa:";var U=/*#__PURE__*/function(){function U(e,a,o,n){_class_call_check(this,U);this.url=e;this.login=a;this.password=o;this.cookie=n}_create_class(U,[{key:"fetchWithAuth",value:function fetchWithAuth(o){return d(this,arguments,function(e){var a,s,n,_tmp,_tmp1;var _arguments=arguments;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=_arguments.length>1&&_arguments[1]!==void 0?_arguments[1]:{};return[4,fetch(this.url+e,E(A({},a),{credentials:"include"}))];case 1:n=_state.sent();_tmp=!n.ok&&n.status===403;if(!_tmp)return[3,4];return[4,this.authorize()];case 2:_state.sent();return[4,fetch(this.url+e,E(A({},a),{credentials:"include"}))];case 3:_tmp=n=_state.sent();_state.label=4;case 4:if(_tmp,!n.ok)throw new Error("Failed to get "+e);if(!((s=n.headers.get("content-type"))!=null&&s.includes("application/json")))return[3,6];return[4,n.json()];case 5:_tmp1=_state.sent();return[3,8];case 6:return[4,n.text()];case 7:_tmp1=_state.sent();_state.label=8;case 8:return[2,_tmp1]}})})}},{key:"authorize",value:function authorize(){return d(this,null,function(){var e,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:e=new URLSearchParams;e.append("username",this.login),e.append("password",this.password);return[4,fetch(this.url+"/api/v2/auth/login",{method:"POST",body:e,credentials:"include"})];case 1:a=_state.sent();if(!a.ok)throw new Error("qBittorrent login failed");this.cookie=a.headers.get("set-cookie")||void 0;return[2]}})})}},{key:"getTorrents",value:function getTorrents(){return d(this,null,function(){var e,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.fetchWithAuth("/api/v2/torrents/info")];case 1:e=_state.sent();return[4,this.fetchWithAuth("/api/v2/app/preferences")];case 2:a=_state.sent();return[2,this.formatTorrents(e,a)]}})})}},{key:"getData",value:function getData(){return d(this,null,function(){var n,e,a,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.fetchWithAuth("/api/v2/sync/maindata")];case 1:e=_state.sent(),a=(n=e.torrents)!=null?n:[];a=Array.isArray(a)?a:Object.keys(a).map(function(s){return E(A({},a[s]),{hash:s})});return[4,this.fetchWithAuth("/api/v2/app/preferences")];case 2:o=_state.sent();return[2,{torrents:this.formatTorrents(a,o),info:{freeSpace:e.server_state.free_space_on_disk}}]}})})}},{key:"addTorrent",value:function addTorrent(e,a){return d(this,null,function(){var o,n,s,r,l,m;return _ts_generator(this,function(_state){switch(_state.label){case 0:o=new FormData,n=new URL(a.MagnetUri||a.Link);n.searchParams.delete("dn"),o.append("urls",n.toString()),o.append("tags",x(e).join(",")),o.append("sequentialDownload","true");s=M(e);if(!s)return[3,2];return[4,this.fetchWithAuth("/api/v2/app/preferences")];case 1:r=_state.sent(),l=r==null?void 0:r.save_path;if(l){m=l.replace(/[\\/]+$/g,"")+s;o.append("savepath",m)}_state.label=2;case 2:return[4,this.fetchWithAuth("/api/v2/torrents/add",{method:"POST",body:o})];case 3:_state.sent();return[2]}})})}},{key:"startTorrent",value:function startTorrent(e){return d(this,null,function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=new URLSearchParams;a.append("hashes",String(e.externalId));return[4,this.fetchWithAuth("/api/v2/torrents/start",{method:"POST",body:a})];case 1:_state.sent();return[2]}})})}},{key:"stopTorrent",value:function stopTorrent(e){return d(this,null,function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=new URLSearchParams;a.append("hashes",String(e.externalId));return[4,this.fetchWithAuth("/api/v2/torrents/stop",{method:"POST",body:a})];case 1:_state.sent();return[2]}})})}},{key:"hideTorrent",value:function hideTorrent(e){return d(this,null,function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=new URLSearchParams;a.append("hashes",String(e.externalId)),a.append("tags","hide");return[4,this.fetchWithAuth("/api/v2/torrents/addTags",{method:"POST",body:a})];case 1:_state.sent();return[2]}})})}},{key:"removeTorrent",value:function removeTorrent(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return d(this,null,function(){var o;return _ts_generator(this,function(_state){switch(_state.label){case 0:o=new URLSearchParams;o.append("hashes",String(e.externalId)),o.append("deleteFiles",a?"true":"false");return[4,this.fetchWithAuth("/api/v2/torrents/delete",{method:"POST",body:o})];case 1:_state.sent();return[2]}})})}},{key:"getFiles",value:function getFiles(e){return d(this,null,function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:a=new URLSearchParams;a.append("hash",String(e.externalId));return[4,this.fetchWithAuth("/api/v2/torrents/files?".concat(a.toString()))];case 1:return[2,_state.sent().map(function(n){var s,r;return{bytesCompleted:Math.floor(n.progress*n.size),length:n.size,name:n.name,begin_piece:(s=n.piece_range)==null?void 0:s[0],end_piece:(r=n.piece_range)==null?void 0:r[1]}})]}})})}},{key:"formatTorrents",value:function formatTorrents(e,a){return e.sort(function(o,n){return n.added_on-o.added_on}).filter(function(o){return!o.tags.includes("hide")}).map(function(o){return{id:O(o.tags),type:R(o.tags),externalId:o.hash,name:o.name,status:de(o.state),percentDone:o.progress,totalSize:o.size,eta:o.eta,speed:o.dlspeed,files:[],seeders:o.num_seeds,activeSeeders:o.num_complete,hash:o.hash,path:o.save_path.replace(a.save_path,"")}})}}]);return U}();var z=/*#__PURE__*/function(){function z(e,a,o,n){_class_call_check(this,z);this.url=e;this.login=a;this.password=o;this.sessionId=n}_create_class(z,[{key:"POST",value:function POST(e){return d(this,null,function(){var a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,fetch(this.url,{method:"POST",headers:{Authorization:"Basic ".concat(btoa(this.login+":"+this.password)),"Content-Type":"application/json","X-Transmission-Session-Id":this.sessionId||""},body:JSON.stringify(e)})];case 1:a=_state.sent();if(a.status===409){if(this.sessionId=a.headers.get("X-Transmission-Session-Id"),this.sessionId==null)throw new Error("Can`t authorize to Transmission RPC");return[2,this.POST(e)]}if(!a.ok)throw{message:"Transmission RPC error: ".concat(a.statusText),status:a.status};return[4,a.json()];case 2:return[2,_state.sent()]}})})}},{key:"getSession",value:function getSession(){var e={method:"session-get"};return this.POST(e)}},{key:"addTorrent",value:function addTorrent(e){var a={method:"torrent-add",arguments:e};return this.POST(a)}},{key:"getTorrents",value:function getTorrents(e){var a={method:"torrent-get",arguments:e};return this.POST(a)}},{key:"setTorrent",value:function setTorrent(e){var a={method:"torrent-set",arguments:e};return this.POST(a)}},{key:"startTorrent",value:function startTorrent(e){var a={method:"torrent-start",arguments:e};return this.POST(a)}},{key:"stopTorrent",value:function stopTorrent(e){var a={method:"torrent-stop",arguments:e};return this.POST(a)}},{key:"removeTorrent",value:function removeTorrent(e){var a={method:"torrent-remove",arguments:e};return this.POST(a)}}]);return z}();var F=/*#__PURE__*/function(){function F(e,a,o){_class_call_check(this,F);this.url=e;this.login=a;this.password=o;this.client=new z(e+"/transmission/rpc",a,o)}_create_class(F,[{key:"getTorrents",value:function getTorrents(){return d(this,null,function(){var n,s,e,a;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.client.getSession()];case 1:e=_state.sent(),a=((n=e==null?void 0:e.arguments)==null?void 0:n["download-dir"])||"";return[4,this.client.getTorrents({fields:["id","name","status","percentDone","sizeWhenDone","rateDownload","eta","labels","files","peersConnected","peersSendingToUs","trackerStats","hashString","downloadDir"]})];case 2:return[2,((s=_state.sent().arguments)==null?void 0:s.torrents.filter(function(r){return!Array.isArray(r.labels)||r.labels.indexOf("hide")===-1}).map(function(r){var _Math;var w;var l=0,m=0;return Array.isArray(r.trackerStats)&&(l=(_Math=Math).max.apply(_Math,_to_consumable_array(r.trackerStats.map(function(f){return f.seederCount||0})).concat([0]))),m=r.peersSendingToUs||0,{id:O(r.labels),type:R(r.labels),externalId:r.id,name:r.name,status:ie(r.status),percentDone:r.percentDone,totalSize:r.sizeWhenDone,eta:r.eta,speed:r.rateDownload,files:r.files,seeders:l,activeSeeders:m,hash:r.hashString,path:((w=r.downloadDir)==null?void 0:w.replace(a,""))||""}}).filter(function(r){return r.id}))||[]]}})})}},{key:"addTorrent",value:function addTorrent(e,a){return d(this,null,function(){var r,l,o,n,m,w,s,_tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:o={paused:!1,sequential_download:!0,filename:a.MagnetUri||a.Link,labels:x(e)},n=M(e);if(!n)return[3,2];return[4,this.client.getSession()];case 1:m=_state.sent(),w=(r=m==null?void 0:m.arguments)==null?void 0:r["download-dir"];w&&(o["download-dir"]=w.replace(/[\\/]+$/g,"")+n);_state.label=2;case 2:return[4,this.client.addTorrent(o)];case 3:s=_state.sent();_tmp=(l=s.arguments)!=null&&l["torrent-added"];if(!_tmp)return[3,5];return[4,this.client.setTorrent({ids:[s.arguments["torrent-added"].id],labels:x(e)})];case 4:_tmp=_state.sent();_state.label=5;case 5:_tmp;return[2]}})})}},{key:"startTorrent",value:function startTorrent(e){return d(this,null,function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.client.startTorrent({ids:[e.externalId]})];case 1:_state.sent();return[2]}})})}},{key:"stopTorrent",value:function stopTorrent(e){return d(this,null,function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.client.stopTorrent({ids:[e.externalId]})];case 1:_state.sent();return[2]}})})}},{key:"hideTorrent",value:function hideTorrent(e){return d(this,null,function(){var n,s,o;return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.client.getTorrents({ids:[e.externalId],fields:["labels"]})];case 1:o=((s=(n=_state.sent().arguments)==null?void 0:n.torrents[0])==null?void 0:s.labels)||[];return[4,this.client.setTorrent({ids:[e.externalId],labels:_to_consumable_array(o).concat(["hide"])})];case 2:_state.sent();return[2]}})})}},{key:"removeTorrent",value:function removeTorrent(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;return d(this,null,function(){return _ts_generator(this,function(_state){switch(_state.label){case 0:return[4,this.client.removeTorrent({ids:[e.externalId],"delete-local-data":a})];case 1:_state.sent();return[2]}})})}},{key:"getFiles",value:function getFiles(e){return d(this,null,function(){return _ts_generator(this,function(_state){return[2,e.files]})})}},{key:"getData",value:function getData(){return d(this,null,function(){var _tmp;return _ts_generator(this,function(_state){switch(_state.label){case 0:_tmp={};return[4,this.getTorrents()];case 1:return[2,(_tmp.torrents=_state.sent(),_tmp.info={freeSpace:0},_tmp)]}})})}}]);return F}();var D=/*#__PURE__*/function(){function D(){_class_call_check(this,D)}_create_class(D,null,[{key:"getClient",value:function getClient(){if(!this.client){var e=Lampa.Storage.field(I),a=e.split(";");a.length===1&&D.buildClient(e),a.length>1&&D.selectUrl(a)}return this.client}},{key:"reset",value:function reset(){this.client=void 0}},{key:"buildClient",value:function buildClient(e){var a=Lampa.Storage.field(J)===1,o=Lampa.Storage.field(j),n=Lampa.Storage.field(H);this.client=a?new U(e,o,n):new F(e,o,n)}},{key:"selectUrl",value:function selectUrl(e){return d(this,null,function(){var _this,a;return _ts_generator(this,function(_state){_this=this;a=e.map(function(o){return fetch(o+"/ping",{cache:"no-cache"}).then(function(n){return n.ok?o:Promise.reject()})});return[2,new Promise(function(o){var n=0,s=!1;a.forEach(function(r){return r.then(function(l){s||(s=!0,_this.buildClient(l),o())}).catch(function(){++n===a.length&&!s&&(_this.buildClient(e[0]),o())})})})]})})}}]);return D}();D.isConnected=!1;var p=D;var Ce='<div class="full-start__button selector button--download">\r\n    {icon}\r\n    <span>{text}</span>\r\n</div>';window.plugin_transmission_ready||(window.appready?ke():Lampa.Listener.follow("app",function(t){t.type==="ready"&&ke()}))})();